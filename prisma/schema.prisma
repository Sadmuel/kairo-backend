generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(uuid())
  email             String   @unique
  passwordHash      String
  name              String
  currentStreak     Int      @default(0)
  longestStreak     Int      @default(0)
  lastCompletedDate DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  days          Day[]
  events        Event[]
  todos         Todo[]
  refreshTokens RefreshToken[]
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Day {
  id                 String   @id @default(uuid())
  date               DateTime @db.Date
  isCompleted        Boolean  @default(false)
  nextTimeBlockOrder Int      @default(0)
  userId             String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  timeBlocks TimeBlock[]
  todos      Todo[]

  @@unique([userId, date])
}

model TimeBlock {
  id            String   @id @default(uuid())
  name          String
  startTime     String
  endTime       String
  isCompleted   Boolean  @default(false)
  order         Int
  color         String?
  nextNoteOrder Int      @default(0)
  dayId         String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  day   Day     @relation(fields: [dayId], references: [id], onDelete: Cascade)
  notes Note[]
  todos Todo[]

  @@unique([dayId, order])
}

model Note {
  id          String   @id @default(uuid())
  content     String
  order       Int
  timeBlockId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  timeBlock TimeBlock @relation(fields: [timeBlockId], references: [id], onDelete: Cascade)

  @@unique([timeBlockId, order])
}

model Todo {
  id          String    @id @default(uuid())
  title       String
  isCompleted Boolean   @default(false)
  deadline    DateTime?
  order       Int
  userId      String
  dayId       String?
  timeBlockId String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  day       Day?       @relation(fields: [dayId], references: [id], onDelete: Cascade)
  timeBlock TimeBlock? @relation(fields: [timeBlockId], references: [id], onDelete: Cascade)
}

model Event {
  id             String         @id @default(uuid())
  title          String
  date           DateTime       @db.Date
  color          String?
  isRecurring    Boolean        @default(false)
  recurrenceType RecurrenceType @default(NONE)
  userId         String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum RecurrenceType {
  NONE
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}